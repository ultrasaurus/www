<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>what exactly does rake spec do?</title>
    <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
    <style> 
        #content{margin-top:2rem;margin-left:.5rem}#content ul{padding-left:2em}/*# sourceMappingURL=styles.css.map */

    </style>
</head>

<body>

    <!-- Start Top Bar -->
    <div class="top-bar">
        <div class="top-bar-left">
            <ul class="menu">
                <li><a href="/">The evolving ultrasaurus</a></li>
            </ul>
        </div>
        <div class="top-bar-right">
            <ul class="menu">
                <li><a href="/archives">Archives</a></li>
                <li><a href="/about">About</a></li>
                <li><a href="/speaking">Speaking</a></li>
                <li><a href="/contact">Contact</a></li>
            </ul>
        </div>
    </div>
    <!-- End Top Bar -->

    <div class="row" id="content">
        <div class="medium-8 columns">
            
<h1>what exactly does rake spec do?</h1>

<p><em>May 08, 2011</em></p>


<p>$ rake spec<br>
(in /Users/sarah/src/../my_app)<br>
You have 1 pending migrations:<br>
20110416135407 CreateCourses</p>
<p>The rake spec command reminds us that we need to run our migration before running<br>
our tests. In fact, it does a whole lot more than that. There are a whole bunch of best practices rolled in that one<br>
command. To see exactly what is going on, we can run rake spec with the –trace<br>
option:</p>
<p><code>&lt;br&gt;&lt;/br&gt;$ rake spec --trace&lt;br&gt;&lt;/br&gt;(in /Users/sarah/src/tfr/svn/Book/code/class_app_new_source)&lt;br&gt;&lt;/br&gt;** Invoke spec (first_time)&lt;br&gt;&lt;/br&gt;** Invoke db:test:prepare (first_time)&lt;br&gt;&lt;/br&gt;** Invoke db:abort_if_pending_migrations (first_time)&lt;br&gt;&lt;/br&gt;** Invoke environment (first_time)&lt;br&gt;&lt;/br&gt;** Execute environment&lt;br&gt;&lt;/br&gt;** Execute db:abort_if_pending_migrations&lt;br&gt;&lt;/br&gt;** Execute db:test:prepare&lt;br&gt;&lt;/br&gt;** Invoke db:test:load (first_time)&lt;br&gt;&lt;/br&gt;** Invoke db:test:purge (first_time)&lt;br&gt;&lt;/br&gt;** Invoke environment&lt;br&gt;&lt;/br&gt;** Execute db:test:purge&lt;br&gt;&lt;/br&gt;** Execute db:test:load&lt;br&gt;&lt;/br&gt;** Invoke db:schema:load (first_time)&lt;br&gt;&lt;/br&gt;** Invoke environment&lt;br&gt;&lt;/br&gt;** Execute db:schema:load&lt;br&gt;&lt;/br&gt;** Execute spec&lt;br&gt;&lt;/br&gt;</code></p>
<p>When it says invoke it is calling a particular rake task, but then it will call its dependencies. To really see what is happening in what order, check out the execute commands. The commands db:test:prepare and db:test:load don’t do much themselves, aside from setting up the environment and executing another task or two. We can see from the output that rake is actually executing the following steps:</p>
<ol>
<li>Don’t run the specs if there are pending migrations in the development database. (db:abort_if_pending_migrations)</li>
<li>Drop the test database (db:test:purge)</li>
<li>Load the schema into the test database (db:schema:load in environment “test”)</li>
</ol>
<p>These steps make sure that we are always testing in a clean environment, so we know exactly what we’re testing when we run our specs.</p>
<p>The code that makes this happen in Rails 3, can now be found in <a href="https://github.com/rails/rails/blob/master/activerecord/lib/active_record/railties/databases.rake#L455">railties</a>. (Thanks to <a href="http://twitter.com/pixeltrix">@pixeltrix</a> for pointing me to it.)/62206174505873408</p>




<style>
    .previous {
        display: inline-block;
        margin-left: .5em;
        margin-bottom: .5em
    }

    .next {
        float: right;
        margin-right: .5em;
        margin-bottom: .5em
    }
</style>



<hr>
<nav id="nav-single" class="pager">
    <span class="previous"><a href="/2011/05/javascript-and-ruby-classes/">← javascript and ruby classes</span></a>
    
    <span class="next"><a href="/2011/04/cross-platform-frameworks-mobile-panel/" rel="next">mobile panel: cross-platform frameworks →</span></a></span>
    
</nav>

        </div>
        <div class="medium-3 columns" data-sticky-container>
            <div class="sticky" data-sticky data-anchor="content">
                <!-- <h4>Categories</h4>

<ul>
    

</ul> -->
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.js"></script>
    <script>
        $(document).foundation();
    </script>
</body>

</html>