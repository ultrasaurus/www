<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lucene/solr meetup, july 28</title>
    <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
  </head>
  <body>

    <!-- Start Top Bar -->
    <div class="top-bar">
      <div class="top-bar-left">
        <ul class="menu">
          <li><a href="/">The evolving ultrasaurus</a></li>
        </ul>
      </div>
      <div class="top-bar-right">
        <ul class="menu">
          <li><a href="/about">About</a></li>
          <li><a href="/speaking">Speaking</a></li>
          <li><a href="/contact">Contact</a></li>
          <li><a href="/ultrasaurus">What's an ultrasaurus?</a></li>
        </ul>
      </div>
    </div>
    <!-- End Top Bar -->

    <div class="row" id="content">
      <div class="medium-8 columns">
        
<h1>lucene/solr meetup, july 28</h1>

<p>I attended the <a href="http://www.meetup.com/SFBay-Lucene-Solr-Meetup/calendar/14124466/">Lucene/Solr meetup</a> this week — quite a swank event sponsored by <a href="http://www.salesforce.com/">Salesforce</a> with tasty appetizers, beers and an incredible view of the bay. The three speakers were very knowledgeable and well spoken and I enjoyed hearing about the different applications of Lucene and Solr. Below are my rough notes. For folks who want to learn more about Lucene and Solr, check out the upcoming conference <a href="http://lucenerevolution.org/">Lucene Revolution</a>, Oct 5-8, 2010 in Boston.</p>
<h2>Search@salesforce.com, Bill Press, Salesforce</h2>
<p>Salesforce uses Lucene 2.2 (not Solr) and shared some stats about their seriously large scale operation:</p>
<ul>
<li>millions of searches per day, hundreds of thousands of users</li>
<li>hundreds of millions of doc updates per day</li>
<li>force.com platform, 72,500+ customers, 150,000+ apps</li>
<li>almost half a billion indexing events per day (batches can include &gt; 1000 documents)</li>
<li>Over 8 TB of searchable data</li>
<li>incremental indexing (90% &lt; 3 mins, 70% &lt; 1 min )</li>
<li>6M queries per day, mean search time 250ms (76% &lt; 250 ms, 89% &lt; 500 ms)</li>
</ul>
<p>It’s a multi-tenant architecture, each org has 1-100,000s users and had a single codebase, which means there is just 1 version to support at one time.</p>
<ul>
<li>consistent hashing for node affinity</li>
<li>throttling for fairness</li>
<li>record type bucketing, as well as by org</li>
</ul>
<p>They use post-filtering for:</p>
<ul>
<li>authorization</li>
<li>reranking in the DB, last update</li>
</ul>
<p>They query db to bridge the gap with indexing lag.</p>
<p>They are faced with new search challenges driven by what Salesforce CEO calls “the facebook imperative.” When he started Salesforce, he used to ask “why donesn’t every enterprise app look like amazon?” Now he asks: “why doesn’t every enterprise app look like Facebook?” (side note: this is an echo of what many folks have been saying for a while, that social networking makes sense as a feature of an app, rather than just destinations like Facebook and LinkedIn.)</p>
<p>Salesforce allows you to have a feed on a record, follow accounts, status updates for accounts. They index tracked changed. They need to search this rich set of data which is people articulating their interests. Bill noted that the needs of structured data are really different from unstructured data.</p>
<h2>Practical Relevance, Grant Ingersoll, Lucid Imagination</h2>
<p>Grant Ingersoll spoke of “two tales of relevance”</p>
<ul>
<li>The case of the missing data: you know you have poor relevance when the most important search result is on page 10. For example, the accessories for an item are often listed higher on search results than the item itself.</li>
<li>The power of suggestion. Grant cited a specific case where just adding auto-suggest added 100s of millions to the bottom line.</li>
</ul>
<p>Better search results = less time searching, more time acting</p>
<p>Other cases to consider:</p>
<ul>
<li>Only the first result matters, such as Google’s “I’m feeling lucky”</li>
<li>Known item searches, for example: NetFlix has a high frequency of people searching for specific movies</li>
<li>Are you finding all the documents that are relevant? In the case where you want to analyze all the results returned/</li>
<li>Is zero results the right answer? Where people want to definitely know that something is not present</li>
<li>Is it important that you don’t have a result that doesn’t match (e.g. Yelp doesn’t want to find a plumber talking about unclogging what you just ate when you are looking for a restaurant)</li>
</ul>
<p>Befre undertaking any relevance tuning, you need to define what “better search” means to you. There are many ways to test and measure:</p>
<ul>
<li>a/b testing</li>
<li>log analysis</li>
<li>empirical (top x queries, plus random sample) — read and evaluate queries, top 10, top 50, have your top biz people rate what is important –&gt; leads to actionable data</li>
<li>ask your users, thumbs up/down around your search results</li>
<li>Ad Hoc evaluation</li>
<li>TREC — fixed data set, fixed queries, see open relevance project (open source TREC)</li>
</ul>
<p>Capturing user feedback:</p>
<ul>
<li>log analisys (click analyss)</li>
<li>rating/reviws</li>
<li>filters and facets</li>
</ul>
<p>Grant notes that Lucene searches default to “or” out of the box, when “and” is typically better today. He had a list of links that he suggested we check out (sadly I couldn’t type fast enough, but here are some I wrote down):</p>
<ul>
<li><a href="http://code.google.com/p/luke/">code.google.com/p/luke</a></li>
<li>solar analysis tool</li>
<li><a href="http://sigir.org/">sigir.org</a></li>
<li><a href="http://www.lucidimagination.com/Community/Hear-from-the-Experts/Articles/Debugging-Relevance-Issues-Search?utm_medium=lucene.li-copypaste&amp;utm_source=direct-lucene.li&amp;utm_content=awesm-site">Debugging Relevance Issues in Search</a></li>
</ul>
<p>auto-add phrases to your questies — surround with quotes — automtric win<br>
auto-add a “sloppy phrase” — large slop factor, like an AND, boost when words are close</p>
<h2>Logs, Search, Cloud, Jon Gifford, Loggly</h2>
<p>Logfile managemetn in the cloud (no Hadoop). Logs are painful — distributed, large, ephemeral. Most log search is hightly skewed. “We’re just implementing grep across terabytes of data.” This was a compelling talk, but it took most of my attention to follow, so my notes are weak and may make sense to no one except me:</p>
<p>syslog + 0MQ + SolrCloud<br>
0MQ – not traditional queing, it fails, when it fails we lose data, but it is very fast<br>
Solr give s us facets which gives us graphs</p>
<p>run many indexers, “hot shards” — the indexers update small shards</p>
<p>0MQ gives us node-specific input queues for Solr</p>
<p>nrt + solrCloud = Our Nirvana</p>
<p>Hot shards re chilled when we stop writing to them</p>
<p>Solr is awesome at what it does, but not so good for data mining<br>
— plan to plug in Hadoop for large-volume analytics<br>
Syslog is the only way in for now, adding others, http, scribe, flume,</p>

<hr>
<ul><li>Next: <a href="/2010/08/ruby-meetup-in-tokyo-asakusa-rb/">ruby meetup in tokyo: asakusa.rb</a></li><li>Previous: <a href="/2010/06/learning-tdd-through-test-first-teaching/">learning TDD through test-first teaching</a></li>
</ul>

      </div>
      <div class="medium-3 columns" data-sticky-container>
        <div class="sticky" data-sticky data-anchor="content">
          <h4>Categories</h4>
          <ul>
            <li><a href="#">Skyler</a></li>
            <li><a href="#">Jesse</a></li>
            <li><a href="#">Mike</a></li>
            <li><a href="#">Holly</a></li>
          </ul>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.js"></script>
    <script>
      $(document).foundation();
    </script>
  </body>
</html>



