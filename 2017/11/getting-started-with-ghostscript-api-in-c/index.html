<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>exploring ghostscript API in C</title>
    </head>
    <body>
        
<h1>exploring ghostscript API in C</h1>

<p>Ghostscript lets you do all sorts of PDF and PostScript transformations. It’s got a command-line tool which is great for page-level operations.</p>
<p>Installation on a mac is pretty easy with <a href="https://brew.sh/">homebrew</a>:</p>
<p><code>brew install ghostscript</code></p>
<p>The syntax for the commands not very memorable, but easy once you know it. To get a PNG from a PDF:</p>
<p><code>gs -sDEVICE=pngalpha -o output.png input.pdf</code></p>
<p>We can also use the API to call the engine from C code. Note: to use this from a program we need to publish our source code (or purchase a license from the nice folks who create and maintain Ghostscript), which seems fair to me. See <a href="https://www.ghostscript.com/download/gpdldnld.html">license details</a>.</p>
<p>To do the exact same thing as above, I created a small program based on the <a href="https://www.ghostscript.com/doc/current/API.htm#Example_usage">example in the API doc</a>, which I’ve posted on <a href="https://github.com/ultrasaurus/ghostscript-c-app/tree/pdf2png">github</a>.</p>
<p>What I really want to do is to replace text in a PDF (using one PDF as a template to create another). It seems like all the code I need is available in the Ghostscript library, but maybe not exposed in usable form:</p>
<ul>
<li>Projects Seeking Developers <a href="https://www.biu.ac.il/os_site/documentation/gs/Projects.htm#Driver_architecture">Driver Architecture</a> was the only place in the docs that I learned that we can’t add a driver without modifying the source code: “Currently, drivers must be linked into the executable.” Might be nice for these to be filed as bugs so interested developers might discuss options here. Of course, not sure that making a driver is a good solution to my problem at all.</li>
<li>There’s an option <code>-dFILTERTEXT</code> that removes all text from a PDF that I thought might provide a clue. I found the implementation in <a href="http://git.ghostscript.com/?p=ghostpdl.git;a=blob;f=base/gdevoflt.c;h=5e1b5cf60aa467dae4a913fa2975002c47f0b92e;hb=HEAD">gdevoflt.c</a> with a comment that it was derived from <a href="http://git.ghostscript.com/?p=ghostpdl.git;a=blob;f=base/gdevflp.c;h=2e4a07b1d96429a2771bd7b5ef9af62ce10dac50;hb=HEAD">gdevflp.c</a>.</li>
<li><code>gdevflp</code>: This device is the first ‘subclassing’ device; the intention of subclassing is to allow us to develop a ‘chain’ or ‘pipeline’ of devices, each of which can process some aspect of the graphics methods before passing them on to the next device in the chain.</li>
</ul>
<p>So, this appears to require diving into the inner-workings of Ghostscript, yet the code seems to be structured so that it is easily modifiable for exactly this kind of thing. It seems like it would be possible to add a filter that modifies text, rather than just deleting it, as long as the layout is unaffected. This implies setting up for building and debugging GhostScript from source and the potential investment of staying current with the codebase, which might not work for my very intermittent attention.</p>

<hr>
<ul><li>Next: <a href="/2017/12/event-driven-architectural-patterns/">event-driven architectural patterns</a></li><li>Previous: <a href="/2017/10/getting-started-with-docker/">getting started with docker</a></li>
</ul>

    </body>
</html>