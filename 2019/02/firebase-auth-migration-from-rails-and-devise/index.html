<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>firebase auth migration from rails/devise</title>
    </head>
    <body>
        
<h1>firebase auth migration from rails/devise</h1>

<p>Migration to Firebase from a Heroku-hosted Rails app appears to work seamlessly. I’ve only tested one user, but I could log in with the same password and Facebook account with no end-user intervention.</p>
<p>It took a little experimentation to come up with the correct format for export from <code>heroku psql</code> command line:</p>
<pre><code>\COPY (select id, email, CASE WHEN confirmed_at IS NULL THEN 'false' ELSE 'true' END as Verified, regexp_replace(encode(encrypted_password::bytea, 'base64'), '\n', '') as hash, password_salt::text, screen_name, '' as photo, '' as google_id, '' as google_email, '' as google_name, '' as google_photo, uid as facebook_id, provider_email as facebook_email, '' as fname, '' as fphoto, '' as twitter_id, '' as twitter_mail, '' as twitter_name, '' as twitter_photo, '' as github_id, '' as github_mail, '' as github_name, '' as github_photo, EXTRACT(EPOCH FROM created_at)::bigint, EXTRACT(EPOCH FROM last_sign_in_at)::bigint, '' as phone FROM speakers ORDER BY id limit 160) TO '~/users.csv' WITH (FORMAT csv, DELIMITER ',');

</code></pre>
<p>Which I imported with the following command:</p>
<pre><code>firebase auth:import ~/users.csv     \
    --hash-algo=BCRYPT               \
    --rounds=10                      \

</code></pre>
<p>Check your devise config file <code>config/initializers/devise.rb</code> — encryption options are configurable there.</p>
<h2>Additional Notes</h2>
<p>I found <a href="https://github.com/firebase/quickstart-js/tree/master/auth">these samples</a> helpful to get a test running <em>very</em> quickly.</p>
<p>Firebase auth import requires exactly 26 collumns (for csv import):</p>
<pre><code>UID,Email,Email Verified,Password Hash,Password Salt,Name,Photo URL,Google ID,Google Email,Google Display Name,Google Photo URL,Facebook ID,Facebook Email,Facebook Display Name,Facebook Photo URL,Twitter ID,Twitter Email,Twitter Display Name,Twitter Photo URL,GitHub ID,GitHub Email,GitHub Display Name,GitHub Photo URL,User Creation Time,Last Sign-In Time,Phone Number

</code></pre>

<hr>
<ul><li>Next: <a href="/2019/04/subverting-saurons-business-model/">subverting Sauron&amp;#8217;s business model</a></li><li>Previous: <a href="/2019/01/golang-philosophy/">golang philosophy</a></li>
</ul>

    </body>
</html>